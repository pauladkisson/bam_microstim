# bam_microstim
Adding microstimulation to the Wang 2002 Biophysical Attractor Model of decision-making

## Description of Project Organization
The project is generally run by 4 code scripts:
  1) bam_constants.m defines all the necessary constants, generates connectivities/neuron locations/stimulation conditions for a given simulation.
  2) main.m runs the main simulation program, which simulates leaky-integrate-and-fire dynamics, synaptic currents, task-related currents, background currents, and microstimulation currents for a variety of task conditions (coherences) and microstimulation inputs.  Spike times for each neuron are stored in a containers.map variable called ``recspikes`` in .mat files.
  3) analyze_main.m runs analysis of the raw spike time data to generate data of interest such as accuracy and decision time, and stores them in "decisions.mat" files.
  4)  plot_results.m plots the data generated by analyze_main.m, in a variety of visualizations. each of which calls various functions.

The data is stored in a different folder for each simulation ("Simulation X"), which is determined by the ``sim_name`` variable defined in bam_constants.m.    

## How to use
- Define name of simulation with ``sim_name`` variable in bam_constants.m (ex. "X")
- Adjust parameters as necessary
- Call bam_constants --> saves necessary constants
- Update ``sim_name`` in main.m
- Call main.m --> for each brain/stimulation condition/coherence/trial, saves data in "Simulation X/brainY/data/``stim_amp``nA_*stim_cond*/c=*coherence*/trialZ.mat"
- Update ``sim_name`` in analyze_main.m
- Set ``reconstruct = true`` to reconstruct instaneous population firing rates (``pop_frs``) from spike times (``recspikes``)
- Call analyze_main --> saves analyzed variables in "Simulation X/brainY/data/``stim_amp``nA*stim_cond*/decisions.mat"
- Update ``sim_name`` in plot_results.m
- Uncomment whichever plotting section you want to visualize
- Call plot_results --> visualizes data

## Data Storage
Data is stored in an organized nested folder structure with the following levels
I) Simulation name ("Simulation Test"), which contains \n
    A) conductances.mat, which stores matrices with connection conductances for ampa (``AMPA``), gaba (``GABA``), nmda (``NMDA``) synapses
    B) bam_constants.mat, which stores a variety of useful constants
    C) adja.mat, which stores connection adjacency matrix ``adja``
    D) spikes, which contains the task-related and background input spikes for each trial/coherence under
      1) c=*coherence* (ex. "c=-1.000")
        a) trialX.mat (ex. "trial1.mat")
          i) input.mat, which contains a variable with all the input spikes called ``spikes``
    E) brainX (ex "brain1"), which contains all the nested data/constants for a given brain
      1) r.mat, which stores the locations of each P1 neuron (``ball_r``), and their effective electrical distance (``electric_r``)
      2) ustim, which contains the stimulation currents for each of the stimulation condition
        a) ``stim_amp``nA*stim_cond*.mat (ex. "-28.0nA_galvanic.mat"), which stores the instantaneous microstimulation current for each neuron (``I_ustim``)
      3) data, which contains the data for each trial in a nested structure
        a) ``stim_amp``nA_*stim_cond* (ex. "-28.0nA_galvanic") for each stimulation condition
          i) c=*coherence* ex. ("c=-1.000") for each coherence
            I) trialX.mat (ex. "trial1.mat"), which stores the spike times for each neuron in a containers.map variable (``recspikes``),
                  in which the keys are the neuron number as a string (ex. ``'1'``) and the values are a vector containing the time indices
                  when the neuron fired an action potential (ex. t(recspikes('1')) = [0.521, 1.001, 2.325, 2.9, 2.997, 3.053])
        
